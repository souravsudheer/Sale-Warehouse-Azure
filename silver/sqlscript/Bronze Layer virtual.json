{
	"name": "Bronze Layer virtual",
	"properties": {
		"content": {
			"query": "-- Recreate with correct values\nCREATE EXTERNAL DATA SOURCE bronze_data_source\nWITH (\n    LOCATION = 'https://salessourcream.dfs.core.windows.net/datawarehouse/',\n    CREDENTIAL = bronze_credential\n);\nGO\n\n/*\n===============================================================================\nBronze External Tables - Final Configuration\n===============================================================================\nCreating external tables with your exact file paths and names\n===============================================================================\n*/\n\n-- Create Bronze Schema if it doesn't exist\nIF NOT EXISTS (SELECT * FROM sys.schemas WHERE name = 'bronze')\n    EXEC('CREATE SCHEMA bronze');\nGO\n\n-- 1. Bronze CRM Customer Info\nCREATE EXTERNAL TABLE bronze.crm_cust_info (\n    cst_id VARCHAR(50),\n    cst_key VARCHAR(50),\n    cst_firstname VARCHAR(100),\n    cst_lastname VARCHAR(100),\n    cst_marital_status VARCHAR(10),\n    cst_gndr VARCHAR(10),\n    cst_create_date VARCHAR(20)\n)\nWITH (\n    LOCATION = 'bronze/crm/cust_info.csv',\n    DATA_SOURCE = bronze_data_source,\n    FILE_FORMAT = csv_file_format\n);\nGO\n\n-- 2. Bronze CRM Product Info\nCREATE EXTERNAL TABLE bronze.crm_prd_info (\n    prd_id VARCHAR(50),\n    prd_key VARCHAR(100),\n    prd_nm VARCHAR(200),\n    prd_cost VARCHAR(50),\n    prd_line VARCHAR(10),\n    prd_start_dt VARCHAR(20)\n)\nWITH (\n    LOCATION = 'bronze/crm/prd_info.csv',\n    DATA_SOURCE = bronze_data_source,\n    FILE_FORMAT = csv_file_format\n);\nGO\n\n-- 3. Bronze CRM Sales Details\nCREATE EXTERNAL TABLE bronze.crm_sales_details (\n    sls_ord_num VARCHAR(50),\n    sls_prd_key VARCHAR(100),\n    sls_cust_id VARCHAR(50),\n    sls_order_dt VARCHAR(20),\n    sls_ship_dt VARCHAR(20),\n    sls_due_dt VARCHAR(20),\n    sls_sales VARCHAR(50),\n    sls_quantity VARCHAR(50),\n    sls_price VARCHAR(50)\n)\nWITH (\n    LOCATION = 'bronze/crm/sales_details.csv',\n    DATA_SOURCE = bronze_data_source,\n    FILE_FORMAT = csv_file_format\n);\nGO\n\n-- 4. Bronze ERP Customer AZ12 (note: uppercase filename)\nCREATE EXTERNAL TABLE bronze.erp_cust_az12 (\n    cid VARCHAR(50),\n    bdate VARCHAR(20),\n    gen VARCHAR(20)\n)\nWITH (\n    LOCATION = 'bronze/erp/CUST_AZ12.csv',\n    DATA_SOURCE = bronze_data_source,\n    FILE_FORMAT = csv_file_format\n);\nGO\n\n-- 5. Bronze ERP Location A101 (note: uppercase filename)\nCREATE EXTERNAL TABLE bronze.erp_loc_a101 (\n    cid VARCHAR(50),\n    cntry VARCHAR(50)\n)\nWITH (\n    LOCATION = 'bronze/erp/LOC_A101.csv',\n    DATA_SOURCE = bronze_data_source,\n    FILE_FORMAT = csv_file_format\n);\nGO\n\n-- 6. Bronze ERP Product Category G1V2 (note: uppercase filename)\nCREATE EXTERNAL TABLE bronze.erp_px_cat_g1v2 (\n    id VARCHAR(50),\n    cat VARCHAR(100),\n    subcat VARCHAR(100),\n    maintenance VARCHAR(50)\n)\nWITH (\n    LOCATION = 'bronze/erp/PX_CAT_G1V2.csv',\n    DATA_SOURCE = bronze_data_source,\n    FILE_FORMAT = csv_file_format\n);\nGO\n\n-- Test queries to validate all tables\nSELECT 'crm_cust_info' as table_name, COUNT(*) as row_count FROM bronze.crm_cust_info\nUNION ALL\nSELECT 'crm_prd_info', COUNT(*) FROM bronze.crm_prd_info\nUNION ALL\nSELECT 'crm_sales_details', COUNT(*) FROM bronze.crm_sales_details\nUNION ALL\nSELECT 'erp_cust_az12', COUNT(*) FROM bronze.erp_cust_az12\nUNION ALL\nSELECT 'erp_loc_a101', COUNT(*) FROM bronze.erp_loc_a101\nUNION ALL\nSELECT 'erp_px_cat_g1v2', COUNT(*) FROM bronze.erp_px_cat_g1v2;",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "bronze_verify",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}